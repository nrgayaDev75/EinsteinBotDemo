<!DOCTYPE html>
<html>
<head>
    <title>Einstein Bot</title>
</head>
<body>

   <script type="text/javascript">
(function() {

    // Function to load the Embedded Messaging only if bot is enabled
    function loadEmbeddedMessaging() {

        // Create a plain XMLHttpRequest since API is public
        var xhr = new XMLHttpRequest();
        xhr.open(
            'GET',
            'http://energy-agility-7121--partial.sandbox.my.site.com/services/apexrest/BotStatus',
            true
        );

        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);

                    if (response.enabled === true) {
                        console.log('Einstein Bot enabled – loading Embedded Messaging');
                        initEmbeddedMessaging();
                    } else {
                        console.log('Einstein Bot disabled – widget will not load');
                    }
                } else {
                    console.error('Bot status API failed:', xhr.status);
                }
            }
        };

        xhr.send();
    }

    // Salesforce-generated Embedded Messaging init function
    function initEmbeddedMessaging() {
        try {
            embeddedservice_bootstrap.settings.language = 'en_US'; // Or 'en' / 'en-US'

            embeddedservice_bootstrap.init(
                '00D9r000007DnWj',
                'BlueFoxFinanceWebChannel',
                'https://energy-agility-7121--partial.sandbox.my.site.com/ESWBlueFoxFinanceWebChann1765841281185',
                {
                    scrt2URL: 'https://energy-agility-7121--partial.sandbox.my.salesforce-scrt.com'
                }
            );
        } catch (err) {
            console.error('Error loading Embedded Messaging: ', err);
        }
    }

    // Start by checking bot status
    loadEmbeddedMessaging();

})();
</script>

<!-- Salesforce Embedded Messaging bootstrap script -->
<script type="text/javascript" 
        src="https://energy-agility-7121--partial.sandbox.my.site.com/ESWBlueFoxFinanceWebChann1765841281185/assets/js/bootstrap.min.js">
</script>
</body>
</html>
